= Boom Blast – Multiplayer Bomberman Clone

:sectnums:
:icons: font
:source-highlighter: coderay

== Giới thiệu
Boom Blast là trò chơi lấy cảm hứng từ *Bomberman*, được phát triển theo kiến trúc web.
Mục tiêu:
* Xây dựng gameplay đặt bom – phá tường – ăn item cơ bản
* Hỗ trợ nhiều người chơi online
* Áp dụng Java 21+, PostgreSQL 17+, MyBatis, WebSocket, Prometheus/Grafana
* Thực hành OOP, SOLID, và Design Patterns trong thiết kế

== Kiến trúc hệ thống
Hệ thống chia thành 2 phần chính: **frontend** (game client) và **backend** (game server).

image::docs/images/architecture.png[alt="System Architecture",width=800,align=center]

== Công nghệ sử dụng
* **Frontend**: (late updated)
* **Backend**: Java 21+, Spring Boot, Maven, MyBatis, WebSocket
* **Database**: PostgreSQL 17+
* **Monitoring**: Prometheus, Grafana

== Yêu cầu hệ thống
* JDK 21+
* PostgreSQL 17+

== Cấu trúc thư mục
[source]
----
boom-blast/
  frontend/
    src/org/nghlong3004/boombattle
    index.html
    vite.config.ts
  backend/
    src/main/java/org/nghlong3004/boombattle
    src/main/resources
    src/test/java/org/nghlong3004/boombattle
    pom.xml
  images/
  README.adoc
----

== Thành phần hệ thống
=== Frontend
* Render bản đồ dạng lưới (tilemap)
* Điều khiển người chơi: di chuyển, đặt bom
* WebSocket: gửi INPUT, nhận SNAPSHOT
* Giao diện lobby, leaderboard

=== Backend
* Quản lý phòng chơi (lobby)
* Tick loop (20–30 Hz): bom, nổ, va chạm
* Authoritative server: ngăn cheat, đồng bộ state
* REST API:


=== Database (PostgreSQL + MyBatis)


=== Monitoring
* Spring Boot Actuator + Micrometer export metrics
* Prometheus scrape dữ liệu
* Grafana dashboard: latency, FPS, số phòng, số người chơi

== Machine
Machine được thiết kế với Strategy pattern, mỗi cấp độ triển khai một Machine riêng.

=== EASY
* Chọn ngẫu nhiên hướng di chuyển an toàn
* 20% cơ hội đặt bom khi gần tường phá được hoặc đối thủ
* Ưu: đơn giản, nhanh
* Nhược: yếu, dễ đoán

=== NORMAL
* Sử dụng BFS tìm đường ngắn nhất tới mục tiêu an toàn (item, vị trí lợi thế)
* DFS tùy chọn cho hành vi “đuổi sát”
* Hợp với bản đồ nhỏ, mức chơi cân bằng

=== HARD
* A* tìm đường tối ưu với heuristic Manhattan distance
* Tính thêm chi phí rủi ro (danger map) và lợi ích phá tường mềm
* Ưu: khôn, khó đối phó
* Nhược: tốn CPU hơn

=== Logic chung
* Mục tiêu là chiến thắng người chơi
* Machine sẽ luôn chạy tới người chơi để thả boom
* Thả bom nếu tồn tại đường chạy ra ngoài
* Tìm đường đi ngắn nhất tới ô an toàn

== Design Patterns & OOP
=== Strategy
* `Machine` interface
* Các triển khai: `EasyMachine`, `NormalMachine`, `HardMachine`

=== State
* Quản lý vòng đời game: `MenuState`, `LobbyState`, `InGameState`, `ResultState`

=== Command
* Lưu input (`MoveCommand`, `PlaceBombCommand`) cho replay và test

=== Observer
* Event server (explosion, death) → client subscribe để update UI

=== Factory/Builder
* Tạo `Bomb`, `Explosion`, `Match` theo cấu hình

=== Repository
* `UserRepository`, `MatchRepository` với MyBatis

=== Template Method
* Khung xử lý Machine: `plan() -> evaluate() -> act()`

== Luồng dữ liệu

image::docs/images/sequence.png[alt="Sequence Diagram",width=600,align=center]

== Roadmap phát triển
* Sprint 1: Game loop cơ bản (map, player, bomb, explosion)
* Sprint 2: Local multiplayer
* Sprint 3: Backend server với WebSocket + REST API
* Sprint 4: Lobby + leaderboard + PostgreSQL
* Sprint 5: Machine (Easy/Normal/Hard)
* Sprint 6: Monitoring stack (Prometheus + Grafana)
* Sprint 7: Polish UI, asset, âm thanh
